# 저격 홀덤 게임 분석 및 개선사항 (Plan 2)

## 📋 현재 구현 상태 분석

### ✅ 잘 구현된 부분
1. **기본 게임 구조**
   - 2장의 개인 카드 + 4장의 공유 카드 시스템
   - 2차례 베팅 라운드 (공유 카드 2장씩 공개)
   - 포커 족보 평가 시스템 (포카드, 풀하우스, 스트레이트 등)

2. **저격 시스템 기본 틀**
   - 족보와 최고 카드 선언
   - 저격 성공/실패 판정 구조
   - UI 모달을 통한 저격 선언

3. **생존 확정 시스템**
   - 75칩을 통한 생존 보장
   - 생존자는 칩 손실 면제

4. **실시간 시스템**
   - Supabase Realtime을 통한 게임 상태 동기화
   - 턴 기반 게임 진행

### ❌ 문제점 및 개선 필요사항

## 1. 🎯 저격 시스템 문제점

### 현재 구현의 문제
```typescript
// 현재: 한 명만 저격 가능
const targetPlayer = players.find(p => 
  p.id !== currentUserPlayer.id && 
  p.is_in_game && 
  p.is_folded !== true
);
```

### 개선사항
- **데블스 플랜 실제 규칙**: 여러 플레이어가 동시에 서로 다른 대상을 저격 가능
- **현재 문제**: 첫 번째 플레이어만 저격하고 나머지는 패스만 가능
- **해결방안**: 저격 대상 선택 UI 추가, 다중 저격 허용

## 2. 🃏 카드 및 족보 시스템 문제점

### 카드 범위 검증 필요
```typescript
// 현재: 1-10 카드 사용
// 검증 필요: 데블스 플랜에서 실제 사용하는 카드 범위
```

### 족보 우선순위 재검토
```typescript
// 현재 구현된 족보 순서
1. 포카드 (Four of a Kind)
2. 풀하우스 (Full House)  
3. 스트레이트 (Straight)
4. 트리플 (Three of a Kind)
5. 투페어 (Two Pair)
6. 원페어 (One Pair)
7. 하이카드 (High Card)
```

### 개선사항
- **플러시(Flush) 누락**: 일반적으로 풀하우스보다 낮고 스트레이트보다 높음
- **스트레이트 플러시** 누락: 가장 높은 족보
- **로얄 플러시** 고려 여부

## 3. 🎮 게임 플로우 문제점

### 저격 타이밍 이슈
```typescript
// 현재: 2차 베팅 후 저격
// 확인 필요: 정확한 저격 타이밍
```

### 개선사항
1. **저격 단계 명확화**
   - 언제 저격 선언하는지 명시
   - 모든 플레이어가 저격 기회를 가져야 함

2. **턴 순서 관리**
   - 저격 선언 순서 (딜러부터? 베팅 순서와 동일?)
   - 시간 제한 설정

## 4. 💰 칩 및 베팅 시스템 개선

### 현재 문제점
```typescript
export const INITIAL_CHIPS = 60;
export const SURVIVAL_CHIP_GOAL = 75;
export const BASE_BET_AMOUNT = 1;
```

### 개선사항
1. **베팅 한도 시스템**
   - 현재: `min_chips_for_betting_limit` (가장 적은 칩 기준)
   - 검토 필요: 실제 데블스 플랜의 베팅 규칙

2. **올인 상황 처리**
   - 칩이 부족한 플레이어의 올인 처리
   - 사이드 팟(Side Pot) 구현 필요성

## 5. 🏆 승부 판정 시스템 개선

### 저격 성공 시 처리
```typescript
// 현재: 저격당한 플레이어 족보를 최하위로 처리
// 문제: 여러 명이 저격당했을 때의 순위 처리 모호
```

### 개선사항
1. **저격 보상 시스템**
   - 저격 성공 시 추가 칩 보상
   - 저격 실패 시 페널티

2. **복합 상황 처리**
   - 여러 명이 저격당한 경우
   - 저격자와 피저격자가 모두 저격당한 경우

## 6. 🎨 UI/UX 개선사항

### 현재 부족한 부분
1. **저격 대상 선택 UI**
   - 현재: 자동으로 첫 번째 대상 선택
   - 필요: 플레이어가 직접 저격 대상 선택

2. **게임 진행 상황 표시**
   - 현재 단계 명확한 표시
   - 저격 선언 현황 실시간 표시

3. **족보 확률 도우미**
   - 현재 카드로 만들 수 있는 족보 힌트
   - 저격 성공 확률 표시 (선택사항)

## 7. 🔧 기술적 개선사항

### 실시간 동기화 강화
```typescript
// 현재: 기본적인 Realtime 구독
// 개선: 더 세밀한 상태 동기화
```

### 에러 처리 강화
```typescript
// 현재: 기본적인 에러 처리
// 필요: 네트워크 오류, 동시성 이슈 처리
```

### 데이터 검증 강화
- 클라이언트-서버 간 데이터 일관성 검증
- 부정 행위 방지 시스템

## 📝 우선순위별 개선 계획

### 🚨 High Priority
1. **저격 시스템 완전 재구현**
   - 다중 저격 허용
   - 저격 대상 선택 UI
   - 저격 보상/페널티 시스템

2. **족보 시스템 보완**
   - 플러시, 스트레이트 플러시 추가
   - 족보 우선순위 재검토

### 🔶 Medium Priority
3. **게임 플로우 정교화**
   - 저격 타이밍 명확화
   - 턴 시간 제한

4. **UI 개선**
   - 저격 상황 시각화
   - 게임 진행 상황 표시

### 🔷 Low Priority
5. **추가 기능**
   - 게임 통계
   - 리플레이 기능
   - 관전 모드

## 🎯 다음 단계 액션 아이템

1. **데블스 플랜 영상 재분석** - 정확한 게임 규칙 파악
2. **저격 시스템 설계서 작성** - 다중 저격 처리 로직
3. **족보 시스템 업데이트** - 플러시 계열 족보 추가
4. **UI 와이어프레임 작성** - 저격 대상 선택 화면
5. **데이터베이스 스키마 수정** - 다중 저격 지원

## 🔍 추가 조사 필요사항

1. **정확한 저격 규칙**
   - 저격 타이밍
   - 저격 보상 시스템
   - 동시 저격 처리

2. **베팅 시스템**
   - 레이즈 한도
   - 올인 처리
   - 사이드 팟

3. **승부 판정**
   - 저격 성공 시 족보 처리
   - 동점자 처리 규칙

---

이 문서는 현재 구현된 저격 홀덤 게임의 문제점과 개선사항을 정리한 것입니다. 
실제 데블스 플랜의 규칙과 비교하여 더 정확하고 재미있는 게임으로 발전시키는 것이 목표입니다. 